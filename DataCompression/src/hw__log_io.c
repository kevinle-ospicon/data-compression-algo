/*============================================================================
@brief A C source file for write/read log file
------------------------------------------------------------------------------
<!-- Written by Kevin (Phuc) Le Dinh -->
<!-- Copyright (C) 2018 All rights reserved -->
============================================================================*/

/*----------------------------------------------------------------------------
  @brief
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  include files
----------------------------------------------------------------------------*/
#include "hw__log_io.h"
#include <string.h>
#include <stdio.h>

/*----------------------------------------------------------------------------
  manifest constants
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  type definitions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  macros
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  prototypes
----------------------------------------------------------------------------*/
static void hw__log_io_append_to_file( uint8_t * data_ptr , uint8_t size );

/*----------------------------------------------------------------------------
  global variables
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  static variables
----------------------------------------------------------------------------*/
static uint8_t hw__log_io_data_ptr[ HW__LOG_IO_MAX_DATA_LEN ];
static uint8_t hw__log_io_data_size;

/*----------------------------------------------------------------------------
  public functions
----------------------------------------------------------------------------*/

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void hw__log_io_init( void )
{
    memset( hw__log_io_data_ptr , 0 , HW__LOG_IO_MAX_DATA_LEN );
    hw__log_io_data_size = 0;
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
uint8_t hw__log_io_write( uint8_t * data_ptr , uint8_t size )
{   
    if( size > HW__LOG_IO_MAX_DATA_LEN )
    {
        hw__log_io_data_size = HW__LOG_IO_MAX_DATA_LEN;
    }
    else
    {
        hw__log_io_data_size = size;
    }
#ifdef UNIT_TEST    
    memcpy( hw__log_io_data_ptr , data_ptr , hw__log_io_data_size );
#else    
    hw__log_io_append_to_file( data_ptr , hw__log_io_data_size );
#endif    
    return hw__log_io_data_size;
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
uint8_t * hw__log_io_read( uint8_t * size )
{
    * size = hw__log_io_data_size;
    return hw__log_io_data_ptr;
}

/*----------------------------------------------------------------------------
  private functions
----------------------------------------------------------------------------*/

static void hw__log_io_append_to_file( uint8_t * data_ptr , uint8_t size )
{
    FILE *fp;
    fp=fopen("test.bin", "ab");
    fwrite( data_ptr , sizeof( uint8_t ), size, fp);
    fclose (fp);
}
/*----------------------------------------------------------------------------
  End of file
----------------------------------------------------------------------------*/
