/*============================================================================
@brief A C source to run unit test for log data serialisation service
------------------------------------------------------------------------------
<!-- Written by Kevin (Phuc) Le Dinh -->
<!-- Copyright (C) 2018 All rights reserved -->
============================================================================*/

/*----------------------------------------------------------------------------
  @brief
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  include files
----------------------------------------------------------------------------*/
#include "unity.h"
#include "hw__log_io.h"
#include "data__log.h"
#include "dev__log_handler.h"
#include "srv__serialise.h"
#include <string.h>

/*----------------------------------------------------------------------------
  manifest constants
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  type definitions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  macros
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  prototypes
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  global variables
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  static variables
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  public functions
----------------------------------------------------------------------------*/

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void setUp(void)
{
}

void tearDown(void)
{
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_srv__serialise_ConvertTemperatureAsciiToBinary(void)
{
    char * temp_str = "20180119_17:01:01:Temp:22,9\r\n";
    srv__serialise_to_bin( temp_str , strlen( temp_str ) );

    uint8_t data_size = 0;
    uint8_t * data_ptr = hw__log_io_read( & data_size );

    TEST_ASSERT_EQUAL_UINT8( data__log_get_packet_len( data__log_type_temperature ) , data_size );

    data__log_packet_t packet;
    memcpy( & packet , data_ptr , data_size );
    
    TEST_ASSERT_EQUAL_UINT32( 1516381261 , packet.header.timestamp );
    TEST_ASSERT_EQUAL_UINT8( data__log_type_temperature , packet.header.log_type );
    TEST_ASSERT_EQUAL_INT8( 23 , packet.temperature_payload.value );
}

/*----------------------------------------------------------------------------
  private functions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  End of file
----------------------------------------------------------------------------*/