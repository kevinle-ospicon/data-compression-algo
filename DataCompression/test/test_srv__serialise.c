/*============================================================================
@brief A C source to run unit test for log data serialisation service
------------------------------------------------------------------------------
<!-- Written by Kevin (Phuc) Le Dinh -->
<!-- Copyright (C) 2018 All rights reserved -->
============================================================================*/

/*----------------------------------------------------------------------------
  @brief
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  include files
----------------------------------------------------------------------------*/
#include "unity.h"
#include "hw__log_io.h"
#include "data__log.h"
#include "dev__log_handler.h"
#include "srv__serialise.h"
#include "utils/utils.h"
#include <string.h>
#include <time.h>

/*----------------------------------------------------------------------------
  manifest constants
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  type definitions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  macros
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  prototypes
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  global variables
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  static variables
----------------------------------------------------------------------------*/
static data__log_packet_t log_packet;
static char * temp_str = "20180119_17:01:01:Temp:22,9\r\n";

/*----------------------------------------------------------------------------
  public functions
----------------------------------------------------------------------------*/

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void setUp(void)
{
	srv__serialise_init( & log_packet );
}

void tearDown(void)
{
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_srv__serialise_GetEpochTime(void)
{
    srv__serialise_to_bin( temp_str , strlen( temp_str ) );
    TEST_ASSERT_EQUAL_UINT32( 1516381261 , log_packet.header.timestamp );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_srv__serialise_GetTemperatureType(void)
{
    srv__serialise_to_bin( temp_str , strlen( temp_str ) );
    TEST_ASSERT_EQUAL_UINT8( data__log_type_temperature , log_packet.header.log_type );
}

/*============================================================================
@brief
------------------------------------------------------------------------------
@note
============================================================================*/
void test_srv__serialise_GetTemperatureValue(void)
{
    srv__serialise_to_bin( temp_str , strlen( temp_str ) );
    TEST_ASSERT_EQUAL_UINT8( 23 , log_packet.temperature_payload.value );
}

/*----------------------------------------------------------------------------
  private functions
----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------
  End of file
----------------------------------------------------------------------------*/